<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Messenger</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');

    :root {
      --bg-color: linear-gradient(135deg, #0b0c10, #300000);
      --text-color: #ffffff;
      --button-bg: #660000;
      --button-hover: #990000;
      --highlight-color: #ff4d4d;
    }

    body.light {
      --bg-color: linear-gradient(135deg, #ffffff, #dddddd);
      --text-color: #000000;
      --button-bg: #003366;
      --button-hover: #0055aa;
      --highlight-color: #003366;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.4s, color 0.4s;
    }

    h2, h3 {
      color: var(--highlight-color);
      text-align: center;
    }

    input, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #1f1f2e;
      color: #fff;
      box-sizing: border-box;
    }

    input::placeholder, textarea::placeholder {
      color: #bbb;
    }

    button {
      background: var(--button-bg);
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: var(--button-hover);
    }

    canvas {
      display: none;
    }

    #outputImage {
      display: none;
      margin-top: 15px;
      max-width: 100%;
      border: 2px solid #444;
      border-radius: 6px;
    }

    #downloadLink {
      display: none;
      text-decoration: none;
      background: #ff6b81;
      color: white;
      padding: 10px;
      margin-top: 10px;
      display: inline-block;
      border-radius: 4px;
    }

    #downloadLink:hover {
      background: #c44569;
    }

    .theme-toggle {
      background-color: var(--button-bg);
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s, box-shadow 0.3s;
      width: auto;
    }

    .theme-toggle:hover {
      background-color: var(--button-hover);
      box-shadow: 0 0 10px var(--highlight-color), 0 0 20px var(--highlight-color);
    }

    .fire {
      position: absolute;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle at center, orange 0%, red 60%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
      animation: fire-burst 0.6s ease-out forwards;
    }

    @keyframes fire-burst {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    .password-wrapper {
      margin-bottom: 4px;
    }

    .toggle-password {
      width: 100px;
      margin-top: 2px;
      font-size: 12px;
      border-radius: 6px;
      background-color: var(--button-bg);
      color: white;
      border: none;
      cursor: pointer;
    }

    #decodedMessageBox, #decryptedTextBox {
      background-color: #1f1f2e;
      padding: 15px;
      border-radius: 6px;
      margin-top: 12px;
      min-height: 50px;
      border: 1px solid var(--highlight-color);
      color: var(--text-color);
      white-space: pre-wrap;
      font-size: 15px;
    }

    #imageTip {
      display: block;
      background-color: #fff3cd;
      color: #856404;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      border: 1px solid #ffeeba;
    }
  </style>
</head>
<body>

  <!-- Theme Toggle -->
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <p style="margin: 0; font-weight: bold;">Secure Messenger</p>
    <button class="theme-toggle" onclick="triggerFire(event, toggleTheme)">Theme</button>
  </div>

  <!-- Section Switch Buttons -->
  <div style="display: flex; justify-content: center; gap: 10px; margin: 20px 0;">
    <button class="theme-toggle" onclick="showImageSection()">üñºÔ∏è Hide Message in Image</button>
    <button class="theme-toggle" onclick="showSection('textSection')">üìú Hide Message in Text</button>
  </div>

  <!-- Image Section -->
  <div id="imageSection">
    <h2>üîê Hide Message in Image</h2>
    <input type="file" id="imageInput" accept="image/*" />
    <textarea id="messageInput" rows="4" placeholder="Enter your secret message here..."></textarea>
    <div class="password-wrapper">
      <input type="password" id="passwordInput" placeholder="Password (optional)" />
    </div>
    <button type="button" class="toggle-password" onclick="togglePassword('passwordInput', this)">Show</button>
    <button onclick="encodeMessage()">Encrypt & Hide</button>
    <canvas id="canvas"></canvas>
    <img id="outputImage" />
    <a id="downloadLink" download="stego-image.png">Download Image</a>

    <div id="imageTip">
      ‚ö†Ô∏è <strong>Tip:</strong> When sharing the image via WhatsApp or other social media platforms, please send it as a <strong>document</strong> (not as a photo or image). Most platforms compress images, which may cause data loss. Sending it as a document preserves quality.
    </div>

    <hr />
    <h2>üïµÔ∏è Reveal Message from Image</h2>
    <input type="file" id="decodeImageInput" accept="image/*" />
    <div class="password-wrapper">
      <input type="password" id="decodePasswordInput" placeholder="Password (if any)" />
    </div>
    <button type="button" class="toggle-password" onclick="togglePassword('decodePasswordInput', this)">Show</button>
    <button onclick="decodeMessage()">Reveal Message</button>
    <div id="decodedMessageBox">üîì Hidden message will appear here...</div>
  </div>

  <!-- Text Encryption Section -->
  <div id="textSection" style="display: none;">
    <h2>üìú Encrypt Message in Text</h2>
    <textarea id="textInput" rows="4" placeholder="Enter your secret message..."></textarea>
    <input type="password" id="textPasswordInput" placeholder="Enter password" />
    <button type="button" class="toggle-password" onclick="togglePassword('textPasswordInput', this)">Show</button>
    <button onclick="encryptText()">Encrypt Text</button>

    <h3>üîí Encrypted Text</h3>
    <textarea id="encryptedTextOutput" rows="4" readonly placeholder="Encrypted message will appear here..."></textarea>

    <h3>üîì Decrypt Text</h3>
    <textarea id="decryptInput" rows="4" placeholder="Paste encrypted message here..."></textarea>
    <input type="password" id="decryptPasswordInput" placeholder="Enter password" />
    <button type="button" class="toggle-password" onclick="togglePassword('decryptPasswordInput', this)">Show</button>
    <button onclick="decryptText()">Decrypt Text</button>

    <div id="decryptedTextBox">üîì Decrypted message will appear here...</div>
  </div>

  <p style="text-align: center; margin-top: 40px; font-size: 14px; color: var(--highlight-color);">By - Abhijeet</p>

  <script>
    function toggleTheme() {
      document.body.classList.toggle("light");
    }

    function triggerFire(e, callback) {
      const target = e.currentTarget;
      const fire = document.createElement('div');
      fire.classList.add('fire');
      const rect = target.getBoundingClientRect();
      fire.style.left = (e.clientX - rect.left - 10) + 'px';
      fire.style.top = (e.clientY - rect.top - 10) + 'px';
      target.appendChild(fire);
      setTimeout(() => {
        fire.remove();
        if (callback) callback();
      }, 500);
    }

    function showSection(sectionId) {
      document.getElementById("imageSection").style.display = "none";
      document.getElementById("textSection").style.display = "none";
      document.getElementById(sectionId).style.display = "block";
      document.getElementById('imageTip').style.display = 'block';
    }

    function showImageSection() {
      showSection('imageSection');
      document.getElementById('imageTip').style.display = 'block';
    }

    function togglePassword(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === "password") {
        input.type = "text";
        btn.innerText = "Hide";
      } else {
        input.type = "password";
        btn.innerText = "Show";
      }
    }

    function encodeMessage() {
      const file = document.getElementById('imageInput').files[0];
      const message = document.getElementById('messageInput').value;
      const password = document.getElementById('passwordInput').value;
      if (!file || !message) return alert("Image and message are required!");
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.getElementById('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          let finalMsg = message;
          if (password) finalMsg = CryptoJS.AES.encrypt(message, password).toString();
          const msgBytes = new TextEncoder().encode(finalMsg);
          const msgLength = msgBytes.length;
          if (msgLength > 65535) return alert("Message too long!");
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          const totalBitsNeeded = (msgLength + 2) * 8;
          if (totalBitsNeeded > data.length / 4) return alert("Message is too large for this image.");
          const lengthBytes = [(msgLength >> 8) & 0xFF, msgLength & 0xFF];
          const fullBytes = new Uint8Array([...lengthBytes, ...msgBytes]);
          for (let i = 0; i < fullBytes.length; i++) {
            for (let bit = 0; bit < 8; bit++) {
              const dataIndex = i * 8 + bit;
              data[dataIndex * 4] = (data[dataIndex * 4] & 0xFE) | ((fullBytes[i] >> (7 - bit)) & 1);
            }
          }
          ctx.putImageData(imageData, 0, 0);
          const outputImage = document.getElementById('outputImage');
          outputImage.src = canvas.toDataURL();
          outputImage.style.display = "block";
          const downloadLink = document.getElementById('downloadLink');
          downloadLink.href = outputImage.src;
          downloadLink.style.display = "inline-block";
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function decodeMessage() {
      const file = document.getElementById('decodeImageInput').files[0];
      const password = document.getElementById('decodePasswordInput').value;
      if (!file) return alert("Upload an image to decode!");
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.getElementById('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          const bits = [];
          for (let i = 0; i < data.length / 4; i++) {
            bits.push(data[i * 4] & 1);
          }
          let length = 0;
          for (let i = 0; i < 16; i++) {
            length = (length << 1) | bits[i];
          }
          const bytes = [];
          for (let i = 16; i < 16 + length * 8; i += 8) {
            let byte = 0;
            for (let j = 0; j < 8; j++) {
              byte = (byte << 1) | bits[i + j];
            }
            bytes.push(byte);
          }
          const msgBytes = new Uint8Array(bytes);
          const message = new TextDecoder().decode(msgBytes);
          try {
            if (password) {
              const decrypted = CryptoJS.AES.decrypt(message, password);
              const result = decrypted.toString(CryptoJS.enc.Utf8);
              if (!result) throw new Error("Incorrect password or not encrypted");
              document.getElementById('decodedMessageBox').innerText = "üîì " + result;
            } else {
              document.getElementById('decodedMessageBox').innerText = "üîì " + message;
            }
          } catch (e) {
            alert("Failed to decode message: " + e.message);
          }
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function encryptText() {
      const msg = document.getElementById("textInput").value;
      const pwd = document.getElementById("textPasswordInput").value;
      if (!msg || !pwd) return alert("Message and password are required!");
      try {
        const encrypted = CryptoJS.AES.encrypt(msg, pwd).toString();
        document.getElementById("encryptedTextOutput").value = encrypted;
      } catch (err) {
        alert("Encryption failed: " + err.message);
      }
    }

    function decryptText() {
      const enc = document.getElementById("decryptInput").value;
      const pwd = document.getElementById("decryptPasswordInput").value;
      if (!enc || !pwd) return alert("Encrypted text and password are required!");
      try {
        const decrypted = CryptoJS.AES.decrypt(enc, pwd).toString(CryptoJS.enc.Utf8);
        if (!decrypted) throw new Error("Wrong password or corrupted data");
        document.getElementById("decryptedTextBox").innerText = "üîì " + decrypted;
      } catch (err) {
        alert("Decryption failed: " + err.message);
      }
    }
  </script>
</body>
</html>
